//-----------------------------------------------------------------------------
//! @file TScreen.cpp
//!
//! @author Denis ROBERT (http://denis.beru.free.fr)
//!
//! Copyright 2008-2025
//! @n
//! This file is part of FreeVCL.
//! @n
//!     FreeVCL is free software: you can redistribute it and/or modify
//!     it under the terms of the GNU Lesser General Public License as
//!     published by the Free Software Foundation, either version 3 of
//!     the License, or (at your option) any later version.
//! @n
//!     FreeVCL is distributed in the hope that it will be useful,
//!     but WITHOUT ANY WARRANTY; without even the implied warranty of
//!     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
//!     GNU Lesser General Public License for more details.
//! @n
//!     You should have received a copy of the GNU Lesser General Public
//!     License along with FreeVCL.
//!     If not, see <http://www.gnu.org/licenses/>.
//!
//-----------------------------------------------------------------------------

#include <FreeVcl.h>


//---------------------------------------------------------------------------
// Ressources
//---------------------------------------------------------------------------

#define CURSOR_DRAG_XHOTSPOT 2
#define CURSOR_DRAG_YHOTSPOT 2
#define CURSOR_DRAG_WIDTH 32
#define CURSOR_DRAG_HEIGHT 32
BYTE CURSOR_DRAG_ANDPLANE[] = {
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF,
	0xDF, 0xFF, 0xFF, 0xFF,
	0xCF, 0xFF, 0xFF, 0xFF,
	0xC7, 0xFF, 0xFF, 0xFF,
	0xC3, 0xFF, 0xFF, 0xFF,
	0xC1, 0xFF, 0xFF, 0xFF,
	0xC0, 0xFF, 0xFF, 0xFF,
	0xC0, 0x7F, 0xFF, 0xFF,
	0xC0, 0x3F, 0xFF, 0xFF,
	0xC0, 0x1F, 0xFF, 0xFF,
	0xC0, 0x0F, 0xFF, 0xFF,
	0xC0, 0x07, 0xFF, 0xFF,
	0xC0, 0x03, 0xFF, 0xFF,
	0xC0, 0x3F, 0xFF, 0xFF,
	0xC2, 0x1F, 0x00, 0x0F,
	0xC6, 0x1F, 0x00, 0x0F,
	0xCF, 0x0F, 0x00, 0x0F,
	0xDF, 0x0F, 0x00, 0x0F,
	0xFF, 0x9F, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0x00, 0x0F,
	0xFF, 0xFF, 0xFF, 0xFF,
};
BYTE CURSOR_DRAG_XORPLANE[] = {
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x10, 0x00, 0x00, 0x00,
  0x18, 0x00, 0x00, 0x00,
  0x1C, 0x00, 0x00, 0x00,
  0x1E, 0x00, 0x00, 0x00,
  0x1F, 0x00, 0x00, 0x00,
  0x1F, 0x80, 0x00, 0x00,
  0x1F, 0xC0, 0x00, 0x00,
  0x1F, 0xE0, 0x00, 0x00,
  0x1F, 0xF0, 0x00, 0x00,
  0x1F, 0x80, 0x00, 0x00,
  0x1D, 0x80, 0x00, 0x00,
  0x18, 0xC0, 0x00, 0x00,
  0x10, 0xC0, 0x7F, 0xE0,
  0x00, 0x60, 0x7F, 0xE0,
  0x00, 0x60, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x7F, 0xE0,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00
};

#define CURSOR_NODROP_XHOTSPOT 16
#define CURSOR_NODROP_YHOTSPOT 16
#define CURSOR_NODROP_WIDTH 32
#define CURSOR_NODROP_HEIGHT 32
BYTE CURSOR_NODROP_ANDPLANE[] = {
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xF8, 0x1F, 0xFF,
	0xFF, 0xC0, 0x03, 0xFF,
	0xFF, 0x80, 0x01, 0xFF,
	0xFE, 0x00, 0x00, 0x7F,
	0xFC, 0x00, 0x00, 0x3F,
	0xF8, 0x03, 0xC0, 0x3F,
	0xF8, 0x07, 0xF8, 0x1F,
	0xF0, 0x03, 0xFC, 0x0F,
	0xF0, 0x01, 0xFE, 0x0F,
	0xF0, 0x00, 0xFE, 0x0F,
	0xE0, 0xC0, 0x7E, 0x07,
	0xE0, 0xE0, 0x3F, 0x07,
	0xE0, 0xF0, 0x1F, 0x07,
	0xE0, 0xF8, 0x0F, 0x07,
	0xE0, 0xFC, 0x07, 0x07,
	0xE0, 0xFE, 0x02, 0x07,
	0xF0, 0x7F, 0x00, 0x0F,
	0xF0, 0x7F, 0x80, 0x0F,
	0xF0, 0x3F, 0xC0, 0x0F,
	0xF8, 0x1F, 0xE0, 0x1F,
	0xFC, 0x07, 0xE0, 0x3F,
	0xFC, 0x00, 0x00, 0x3F,
	0xFE, 0x00, 0x00, 0x7F,
	0xFF, 0x80, 0x00, 0xFF,
	0xFF, 0xC0, 0x03, 0xFF,
	0xFF, 0xF8, 0x1F, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0xFF
};
BYTE CURSOR_NODROP_XORPLANE[] = {
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x07, 0xE0, 0x00,
	0x00, 0x3F, 0xFC, 0x00,
	0x00, 0x7F, 0xFE, 0x00,
	0x01, 0xFC, 0x3F, 0x80,
	0x03, 0xE0, 0x07, 0x80,
	0x03, 0xF0, 0x03, 0xC0,
	0x07, 0xF8, 0x01, 0xE0,
	0x07, 0x7C, 0x00, 0xE0,
	0x07, 0x3E, 0x00, 0xE0,
	0x0E, 0x1F, 0x00, 0xF0,
	0x0E, 0x0F, 0x80, 0x70,
	0x0E, 0x07, 0xC0, 0x70,
	0x0E, 0x03, 0xE0, 0x70,
	0x0E, 0x01, 0xF0, 0x70,
	0x0E, 0x00, 0xF8, 0xF0,
	0x07, 0x00, 0x7C, 0xE0,
	0x07, 0x00, 0x3E, 0xE0,
	0x07, 0x80, 0x1F, 0xE0,
	0x03, 0xC0, 0x0F, 0xC0,
	0x01, 0xE0, 0x07, 0x80,
	0x01, 0xF8, 0x1F, 0x80,
	0x00, 0x7F, 0xFF, 0x00,
	0x00, 0x3F, 0xFC, 0x00,
	0x00, 0x07, 0xE0, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00
};

#define CURSOR_HSPLIT_XHOTSPOT 16
#define CURSOR_HSPLIT_YHOTSPOT 16
#define CURSOR_HSPLIT_WIDTH 32
#define CURSOR_HSPLIT_HEIGHT 32
BYTE CURSOR_HSPLIT_ANDPLANE[] = {
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xCC, 0x19, 0xFF,
  0xFF, 0x8C, 0x18, 0xFF,
  0xFF, 0x00, 0x00, 0x7F,
  0xFE, 0x00, 0x00, 0x3F,
  0xFF, 0x00, 0x00, 0x7F,
  0xFF, 0x8C, 0x18, 0xFF,
  0xFF, 0xCC, 0x19, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF
};
BYTE CURSOR_HSPLIT_XORPLANE[] = {
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x03, 0xE0, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x32, 0xA6, 0x00,
  0x00, 0x52, 0xA5, 0x00,
  0x00, 0x9E, 0xBC, 0x80,
  0x01, 0x02, 0xA0, 0x40,
  0x00, 0x9E, 0xBC, 0x80,
  0x00, 0x52, 0xA5, 0x00,
  0x00, 0x32, 0xA6, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x02, 0xA0, 0x00,
  0x00, 0x03, 0xE0, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00
};

#define CURSOR_VSPLIT_XHOTSPOT 16
#define CURSOR_VSPLIT_YHOTSPOT 16
#define CURSOR_VSPLIT_WIDTH 32
#define CURSOR_VSPLIT_HEIGHT 32
BYTE CURSOR_VSPLIT_ANDPLANE[] = {
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0x7F, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xF8, 0x0F, 0xFF,
  0xFF, 0xF8, 0x0F, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0x80, 0x00, 0xFF,
  0xFF, 0x80, 0x00, 0xFF,
  0xFF, 0x80, 0x00, 0xFF,
  0xFF, 0x80, 0x00, 0xFF,
  0xFF, 0x80, 0x00, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0xF8, 0x0F, 0xFF,
  0xFF, 0xF8, 0x0F, 0xFF,
  0xFF, 0xFC, 0x1F, 0xFF,
  0xFF, 0xFE, 0x3F, 0xFF,
  0xFF, 0xFF, 0x7F, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF,
  0xFF, 0xFF, 0xFF, 0xFF
};
BYTE CURSOR_VSPLIT_XORPLANE[] = {
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x80, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x02, 0x20, 0x00,
  0x00, 0x04, 0x10, 0x00,
  0x00, 0x07, 0x70, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x7F, 0xFF, 0x00,
  0x00, 0x40, 0x01, 0x00,
  0x00, 0x7F, 0xFF, 0x00,
  0x00, 0x40, 0x01, 0x00,
  0x00, 0x7F, 0xFF, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x07, 0x70, 0x00,
  0x00, 0x04, 0x10, 0x00,
  0x00, 0x02, 0x20, 0x00,
  0x00, 0x01, 0x40, 0x00,
  0x00, 0x00, 0x80, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00
};


//---------------------------------------------------------------------------
// TScreen
//---------------------------------------------------------------------------

TScreen::TScreen(void): TObject() {
  // Initialisations
  memset(FCursors, 0, sizeof(FCursors));
  memset(bOwned, 0, sizeof(bOwned));
}

//---------------------------------------------------------------------------
TScreen::~TScreen(void) {
	int i;

	for (i = 0; i < (int) (sizeof(FCursors) / sizeof(HCURSOR)); i++) {
		if (bOwned[i]) {
			DestroyCursor(FCursors[i]);
			bOwned[i] = false;
		}
	}
}

//---------------------------------------------------------------------------
TCursor TScreen::Get_Cursor(void) {
  return FCursor;
}

//---------------------------------------------------------------------------
bool TScreen::Set_Cursor(TCursor NewCursor) {

  if (FCursor != NewCursor) {
    FCursor = NewCursor;
    ::SetCursor(Get_Cursors((int) NewCursor));
  }

  return true;
}

//---------------------------------------------------------------------------
HCURSOR TScreen::Get_Cursors(int Index) {
  HCURSOR NewWinCursor;


  if (Index < -31 || 0 < Index) return NULL;

  if (FCursors[-Index] == NULL) {
    switch (Index) {
      case crNone	     : NewWinCursor = NULL; break;
      case crArrow	   : NewWinCursor = LoadCursor(NULL, IDC_ARROW); break;
      case crCross	   : NewWinCursor = LoadCursor(NULL, IDC_CROSS); break;
      case crIBeam	   : NewWinCursor = LoadCursor(NULL, IDC_IBEAM); break;
      case crSizeNESW	 : NewWinCursor = LoadCursor(NULL, IDC_SIZENESW); break;
      case crSizeNS	   : NewWinCursor = LoadCursor(NULL, IDC_SIZENS); break;
      case crSizeNWSE  : NewWinCursor = LoadCursor(NULL, IDC_SIZEWE); break;
      case crSizeWE	   : NewWinCursor = LoadCursor(NULL, IDC_SIZEWE); break;
      case crUpArrow	 : NewWinCursor = LoadCursor(NULL, IDC_UPARROW); break;
      case crHourGlass : NewWinCursor = LoadCursor(NULL, IDC_WAIT); break;
      case crDrag	     :
        FVCL_ASSERT(GetSystemMetrics(SM_CXCURSOR) == CURSOR_DRAG_WIDTH);
        FVCL_ASSERT(GetSystemMetrics(SM_CYCURSOR) == CURSOR_DRAG_HEIGHT);
        NewWinCursor = CreateCursor(HInstance,
                                    CURSOR_DRAG_XHOTSPOT,
                                    CURSOR_DRAG_YHOTSPOT,
                                    CURSOR_DRAG_WIDTH,
                                    CURSOR_DRAG_HEIGHT,
                                    CURSOR_DRAG_ANDPLANE,
                                    CURSOR_DRAG_XORPLANE);
				bOwned[-Index] = true;
        break;
      case crNoDrop	   :
        FVCL_ASSERT(GetSystemMetrics(SM_CXCURSOR) == CURSOR_NODROP_WIDTH);
        FVCL_ASSERT(GetSystemMetrics(SM_CYCURSOR) == CURSOR_NODROP_HEIGHT);
        NewWinCursor = CreateCursor(HInstance,
                                    CURSOR_NODROP_XHOTSPOT,
                                    CURSOR_NODROP_YHOTSPOT,
                                    CURSOR_NODROP_WIDTH,
                                    CURSOR_NODROP_HEIGHT,
                                    CURSOR_NODROP_ANDPLANE,
                                    CURSOR_NODROP_XORPLANE);
				bOwned[-Index] = true;
        break;
      case crHSplit	   :
        FVCL_ASSERT(GetSystemMetrics(SM_CXCURSOR) == CURSOR_HSPLIT_WIDTH);
        FVCL_ASSERT(GetSystemMetrics(SM_CYCURSOR) == CURSOR_HSPLIT_HEIGHT);
        NewWinCursor = CreateCursor(HInstance,
                                    CURSOR_HSPLIT_XHOTSPOT,
                                    CURSOR_HSPLIT_YHOTSPOT,
                                    CURSOR_HSPLIT_WIDTH,
                                    CURSOR_HSPLIT_HEIGHT,
                                    CURSOR_HSPLIT_ANDPLANE,
                                    CURSOR_HSPLIT_XORPLANE);
				bOwned[-Index] = true;
        break;
      case crVSplit	   :
        FVCL_ASSERT(GetSystemMetrics(SM_CXCURSOR) == CURSOR_VSPLIT_WIDTH);
        FVCL_ASSERT(GetSystemMetrics(SM_CYCURSOR) == CURSOR_VSPLIT_HEIGHT);
        NewWinCursor = CreateCursor(HInstance,
                                    CURSOR_VSPLIT_XHOTSPOT,
                                    CURSOR_VSPLIT_YHOTSPOT,
                                    CURSOR_VSPLIT_WIDTH,
                                    CURSOR_VSPLIT_HEIGHT,
                                    CURSOR_VSPLIT_ANDPLANE,
                                    CURSOR_VSPLIT_XORPLANE);
				bOwned[-Index] = true;
        break;
      case crMultiDrag : NewWinCursor = LoadCursor(NULL, IDC_ARROW); break;
      case crSQLWait	 : NewWinCursor = LoadCursor(NULL, IDC_ARROW); break;
      case crNo	       : NewWinCursor = LoadCursor(NULL, IDC_NO); break;
      case crAppStart	 : NewWinCursor = LoadCursor(NULL, IDC_ARROW); break;
      case crHelp	     : NewWinCursor = LoadCursor(NULL, IDC_HELP); break;
#if(WINVER >= 0x0500)
      case crHandPoint : NewWinCursor = LoadCursor(NULL, IDC_HAND); break;
#endif /* WINVER >= 0x0500 */
      case crSizeAll	 : NewWinCursor = LoadCursor(NULL, IDC_SIZEALL); break;
      default          : NewWinCursor = LoadCursor(NULL, IDC_ARROW); break;
    }
    FCursors[-Index] = NewWinCursor;
  }

  return FCursors[-Index];
}

//---------------------------------------------------------------------------
bool TScreen::Set_Cursors(int Index, HCURSOR NewCursors) {

  if (Index < -31 || 0 < Index) return false;

  if (FCursors[-Index] != NewCursors) {
		if (bOwned[-Index]) {
			DestroyCursor(FCursors[-Index]);
			bOwned[-Index] = false;
		}
    FCursors[-Index] = NewCursors;
		if (NewCursors != NULL) bOwned[-Index] = true;
  }

  return true;
}

//---------------------------------------------------------------------------

